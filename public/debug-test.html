<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug POPG AI Widget</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: #f5f5f5;
        }
        .debug-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>POPG AI Widget Debug Test</h1>
    
    <div class="debug-info">
        <h3>Debug Information</h3>
        <div id="debugResults"></div>
    </div>

    <!-- Widget Configuration -->
    <script>
        window.popgConfig = {
            position: 'bottom-right',
            primaryColor: '#007bff',
            margin: '20px'
        };
        
        // Debug logging
        const debugDiv = document.getElementById('debugResults');
        
        function addDebugInfo(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            debugDiv.appendChild(div);
        }
        
        // Check if script loads
        addDebugInfo('Page loaded, checking widget...', 'warning');
        
        // Monitor for widget elements
        function checkWidget() {
            const container = document.getElementById('popg-chat-widget-container');
            const toggle = document.getElementById('popg-chat-toggle');
            
            if (container && toggle) {
                addDebugInfo('✅ Widget elements found!', 'success');
                addDebugInfo(`Container: ${container.style.cssText}`, 'info');
                addDebugInfo(`Toggle: ${toggle.style.cssText}`, 'info');
            } else {
                addDebugInfo('❌ Widget elements not found', 'error');
                if (!container) addDebugInfo('Missing: popg-chat-widget-container', 'error');
                if (!toggle) addDebugInfo('Missing: popg-chat-toggle', 'error');
            }
        }
        
        // Check periodically
        setInterval(checkWidget, 1000);
        
        // Check for script loading
        window.addEventListener('load', () => {
            addDebugInfo('Window loaded event fired', 'warning');
            setTimeout(() => {
                addDebugInfo('Checking for popgWidgetLoaded flag...', 'warning');
                if (window.popgWidgetLoaded) {
                    addDebugInfo('✅ Widget script loaded successfully', 'success');
                } else {
                    addDebugInfo('❌ Widget script not loaded', 'error');
                }
                
                if (window.popgWidget) {
                    addDebugInfo('✅ Widget API available', 'success');
                } else {
                    addDebugInfo('❌ Widget API not available', 'error');
                }
            }, 2000);
        });
        
        // Check for script errors
        window.addEventListener('error', (e) => {
            addDebugInfo(`Script error: ${e.message}`, 'error');
        });
        
    </script>

    <!-- Load the embed script -->
    <script src="/embed.js"></script>
    
    <div class="debug-info">
        <h3>Instructions</h3>
        <p>1. Make sure the server is running on port 3000</p>
        <p>2. Open this page at: <code>http://localhost:3000/debug-test.html</code></p>
        <p>3. Check the debug messages above to see what's happening</p>
        <p>4. Look for the chat widget button in the bottom-right corner</p>
    </div>

</body>
</html>